<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°œì£¼ì„œ ë³€í™˜ ë° ì†¡ì¥ ë“±ë¡ ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --text-color: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #e9ecef;
            --bg-color: #f5f7fa;
            --sidebar-width: 240px;
            --sidebar-bg: #2c3e50;
            --sidebar-hover: #34495e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background: var(--bg-color);
            min-height: 100vh;
            display: flex;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .connection-status {
            padding: 8px 20px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .connection-status .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e74c3c;
        }

        .connection-status.connected .dot { background: #27ae60; }
        .connection-status .text { color: #7f8c8d; }

        .menu-group { margin-bottom: 10px; }

        .menu-group-title {
            padding: 12px 20px 8px;
            color: #95a5a6;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #bdc3c7;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .menu-item:hover { background: var(--sidebar-hover); color: white; }
        .menu-item.active {
            background: var(--sidebar-hover);
            color: white;
            border-left-color: var(--primary-color);
        }

        .menu-item .icon { margin-right: 12px; font-size: 16px; }
        .menu-item .badge {
            margin-left: auto;
            background: var(--danger-color);
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* ì‚¬ìš©ì ë“œë¡­ë‹¤ìš´ */
        .user-dropdown { margin-bottom: 5px; }

        .user-dropdown-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            color: #ecf0f1;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255,255,255,0.05);
            border-left: 3px solid transparent;
        }

        .user-dropdown-header:hover { background: var(--sidebar-hover); }
        .user-dropdown-header.active { border-left-color: var(--success-color); }
        .user-dropdown-header .user-name { display: flex; align-items: center; font-weight: 600; }
        .user-dropdown-header .user-name .icon { margin-right: 10px; }
        .user-dropdown-header .arrow { transition: transform 0.2s; }
        .user-dropdown-header.expanded .arrow { transform: rotate(180deg); }

        .user-dropdown-menu {
            display: none;
            background: rgba(0,0,0,0.15);
        }

        .user-dropdown-menu.show { display: block; }
        .user-dropdown-menu .menu-item { padding-left: 48px; font-size: 13px; }

        .btn-add-user {
            width: 100%;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px dashed rgba(255,255,255,0.3);
            color: #95a5a6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            margin: 10px 20px;
            width: calc(100% - 40px);
        }

        .btn-add-user:hover { background: rgba(255,255,255,0.15); color: #bdc3c7; }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 20px;
            min-height: 100vh;
        }

        .page-header { margin-bottom: 24px; }
        .page-header h1 { color: var(--text-color); font-size: 24px; font-weight: 600; }
        .page-header p { color: var(--text-light); margin-top: 4px; }

        .page-content { display: none; }
        .page-content.active { display: block; }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 24px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ë‹¬ë ¥ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h2 { font-size: 20px; color: var(--text-color); }
        .calendar-nav { display: flex; gap: 8px; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day-header {
            text-align: center;
            padding: 12px;
            font-weight: 600;
            color: var(--text-light);
            font-size: 12px;
        }

        .calendar-day-header.sunday { color: #dc3545; }
        .calendar-day-header.saturday { color: #0d6efd; }

        .calendar-day {
            min-height: 90px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .calendar-day:hover { background: #e3f2fd; border-color: var(--primary-color); }
        .calendar-day.today { border: 2px solid var(--primary-color); background: #e3f2fd; }
        .calendar-day.other-month { opacity: 0.4; }

        .calendar-day-number {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--text-color);
        }

        .calendar-day.sunday .calendar-day-number { color: #dc3545; }
        .calendar-day.saturday .calendar-day-number { color: #0d6efd; }

        .calendar-day-orders { font-size: 11px; }

        .calendar-order-item {
            background: #fff3e0;
            color: #e65100;
            padding: 2px 6px;
            border-radius: 4px;
            margin-bottom: 2px;
            font-size: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-order-item.shipped { background: #e8f5e9; color: #2e7d32; }
        .calendar-order-item.pending { background: #fff3e0; color: #e65100; }

        .calendar-order-count {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 11px;
        }

        /* í¼ ìš”ì†Œ */
        .form-row {
            display: flex;
            gap: 20px;
            align-items: flex-end;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .form-group { flex: 1; min-width: 200px; }
        .form-group label {
            display: block;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: #2980b9; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-success:hover { background: #219a52; }
        .btn-warning { background: var(--warning-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-secondary { background: #95a5a6; color: white; }
        .btn-secondary:hover { background: #7f8c8d; }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-group { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 20px; }

        /* í…Œì´ë¸” */
        .table-container {
            overflow-x: auto;
            margin-top: 16px;
            max-height: 500px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th, td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--text-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:hover { background: #f1f3f5; }

        /* ê²°ê³¼ ë°•ìŠ¤ */
        .result-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }

        .result-box h3 { margin-bottom: 16px; color: var(--text-color); }
        .result-box h4 { margin: 16px 0 8px 0; color: var(--text-color); font-size: 14px; }

        /* ìƒíƒœ */
        .status { padding: 12px; border-radius: 8px; margin-top: 12px; display: none; }
        .status.show { display: block; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #cce5ff; color: #004085; }

        /* ì—…ë¡œë“œ ì˜ì—­ */
        .upload-area {
            border: 3px dashed #bdc3c7;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafbfc;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: var(--primary-color);
            background: #ebf5fb;
        }

        .upload-area input { display: none; }
        .upload-icon { font-size: 48px; margin-bottom: 16px; }
        .upload-text { color: var(--text-light); font-size: 16px; }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 { font-size: 18px; color: var(--text-color); }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-light); }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 20px; border-top: 1px solid var(--border-color); display: flex; gap: 12px; justify-content: flex-end; }

        /* í† ìŠ¤íŠ¸ */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 9999;
        }

        .toast {
            background: var(--text-color);
            color: white;
            padding: 14px 24px;
            border-radius: 8px;
            margin-top: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        }

        .toast.success { background: var(--success-color); }
        .toast.error { background: var(--danger-color); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ë¡œë”© */
        .loading {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading.show { display: flex; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ìš”ì•½ ì •ë³´ */
        .result-summary {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-item .label { color: var(--text-light); font-size: 13px; }
        .summary-item .value { font-weight: 600; color: var(--text-color); }

        /* ìƒíƒœ ë±ƒì§€ */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-badge.shipped { background: #d4edda; color: #155724; }
        .status-badge.not-shipped { background: #fff3cd; color: #856404; }
        .status-badge.paid { background: #cce5ff; color: #004085; }
        .status-badge.not-paid { background: #f8d7da; color: #721c24; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.show { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .mobile-header { display: flex !important; }
            .calendar-day { min-height: 60px; }
            .calendar-day-orders { display: none; }
        }

        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: white;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            padding: 0 16px;
            z-index: 99;
        }

        .hamburger {
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 99;
        }

        .overlay.show { display: block; }
    </style>
</head>
<body>
    <!-- ëª¨ë°”ì¼ í—¤ë” -->
    <div class="mobile-header">
        <button class="hamburger" onclick="toggleSidebar()">â˜°</button>
        <span style="margin-left: 12px; font-weight: 600;">ì£¼ë¬¸ê´€ë¦¬</span>
    </div>

    <div class="overlay" onclick="toggleSidebar()"></div>

    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">ğŸ“¦ ë°œì£¼ì„œ ë³€í™˜ ì‹œìŠ¤í…œ</div>

        <div class="connection-status" id="connection-status">
            <span class="dot"></span>
            <span class="text">ì—°ê²° ì¤‘...</span>
        </div>

        <!-- ê³µí†µ ë©”ë‰´ -->
        <div class="menu-group">
            <div class="menu-group-title">ê³µí†µ</div>
            <div class="menu-item active" onclick="showPage('dashboard')">
                <span class="icon">ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
            </div>
            <div class="menu-item" onclick="showPage('integrated-view')">
                <span class="icon">ğŸ”</span> í†µí•©ì¡°íšŒ
            </div>
        </div>

        <!-- ê´€ë¦¬ ë©”ë‰´ -->
        <div class="menu-group">
            <div class="menu-group-title">ê´€ë¦¬</div>
            <div class="menu-item" onclick="showPage('cost-management')">
                <span class="icon">ğŸ’°</span> ì›ê°€ê´€ë¦¬
            </div>
            <div class="menu-item" onclick="showPage('sku-management')">
                <span class="icon">ğŸ“‹</span> SKUìƒí’ˆê´€ë¦¬
            </div>
            <div class="menu-item" onclick="showPage('vendor-mapping')">
                <span class="icon">ğŸ¢</span> ê±°ë˜ì²˜ë³„ ìƒí’ˆê´€ë¦¬
            </div>
            <div class="menu-item" onclick="showPage('vendor-delivery')">
                <span class="icon">ğŸšš</span> ê±°ë˜ì²˜ë³„ íƒë°°ê´€ë¦¬
            </div>
        </div>

        <!-- ì‚¬ìš©ìë³„ ë©”ë‰´ -->
        <div class="menu-group">
            <div class="menu-group-title">ì‚¬ìš©ìë³„ ì‘ì—…</div>
            <div id="user-menus"></div>
            <button class="btn-add-user" onclick="openAddUserModal()">+ ì‚¬ìš©ì ì¶”ê°€</button>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-content">
        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div id="dashboard" class="page-content active">
            <div class="page-header">
                <h1>ëŒ€ì‹œë³´ë“œ</h1>
                <p>ë°°ì†¡ ì¼ì • ê´€ë¦¬ ë° ë°œì£¼ëŸ‰ ê³„ì‚°</p>
            </div>

            <!-- ë‹¬ë ¥ -->
            <div class="card">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="btn btn-secondary btn-small" onclick="changeMonth(-1)">â—€ ì´ì „</button>
                    </div>
                    <h2 id="calendar-title">2026ë…„ 1ì›”</h2>
                    <div class="calendar-nav">
                        <button class="btn btn-secondary btn-small" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
                        <button class="btn btn-primary btn-small" onclick="goToToday()">ì˜¤ëŠ˜</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendar-grid"></div>
            </div>

            <!-- ê¸°ê°„ë³„ ë°œì£¼ëŸ‰ ê³„ì‚° -->
            <div class="card">
                <div class="card-title">ê¸°ê°„ë³„ ë°œì£¼ëŸ‰ ê³„ì‚°</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ì‹œì‘ì¼</label>
                        <input type="date" id="range-start">
                    </div>
                    <div class="form-group">
                        <label>ì¢…ë£Œì¼</label>
                        <input type="date" id="range-end">
                    </div>
                    <div class="form-group" style="flex: 0;">
                        <label>&nbsp;</label>
                        <button class="btn btn-success" onclick="calculateRangeOrder()">ë°œì£¼ëŸ‰ ê³„ì‚°</button>
                    </div>
                </div>
                <div id="range-result"></div>
            </div>
        </div>

        <!-- í†µí•©ì¡°íšŒ -->
        <div id="integrated-view" class="page-content">
            <div class="page-header">
                <h1>í†µí•©ì¡°íšŒ</h1>
                <p>ëª¨ë“  ì‚¬ìš©ìì˜ ì£¼ë¬¸ ë°ì´í„°ë¥¼ í†µí•©í•˜ì—¬ ì¡°íšŒí•©ë‹ˆë‹¤</p>
            </div>

            <div class="card">
                <div class="card-title">
                    <span>ì „ì²´ ì£¼ë¬¸ í˜„í™©</span>
                    <button class="btn btn-primary btn-small" onclick="loadIntegratedOrders()">ìƒˆë¡œê³ ì¹¨</button>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ì‚¬ìš©ì</label>
                        <select id="integrated-user-filter">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ê¸°ê°„</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="date" id="integrated-date-from" style="flex: 1;">
                            <span>~</span>
                            <input type="date" id="integrated-date-to" style="flex: 1;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ìƒíƒœ</label>
                        <select id="integrated-status-filter">
                            <option value="">ì „ì²´</option>
                            <option value="pending">ë¯¸ì¶œê³ </option>
                            <option value="shipped">ì¶œê³ ì™„ë£Œ</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 0;">
                        <label>&nbsp;</label>
                        <button class="btn btn-secondary" onclick="loadIntegratedOrders()">í•„í„° ì ìš©</button>
                    </div>
                </div>

                <div class="result-summary" id="integrated-summary"></div>
                <div class="table-container" id="integrated-table"></div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="downloadIntegratedExcel()">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
        </div>

        <!-- ì›ê°€ê´€ë¦¬ -->
        <div id="cost-management" class="page-content">
            <div class="page-header">
                <h1>ì›ê°€ê´€ë¦¬</h1>
                <p>ë¶€ìœ„ë³„ ì›ê°€ ë° í¬ì¥ì¬ ì›ê°€ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- ë¶€ìœ„ë³„ ì›ê°€ -->
                <div class="card">
                    <div class="card-title">
                        <span>ë¶€ìœ„ë³„ ì›ê°€ (100gë‹¹)</span>
                        <button class="btn btn-primary btn-small" onclick="openAddPartModal()">+ ì¶”ê°€</button>
                    </div>
                    <div class="table-container" id="parts-table"></div>
                </div>

                <!-- í¬ì¥ì¬ ì›ê°€ -->
                <div class="card">
                    <div class="card-title">
                        <span>í¬ì¥ì¬ ì›ê°€</span>
                        <button class="btn btn-primary btn-small" onclick="openAddPackagingModal()">+ ì¶”ê°€</button>
                    </div>
                    <div class="table-container" id="packaging-table"></div>
                </div>
            </div>
        </div>

        <!-- SKUìƒí’ˆê´€ë¦¬ -->
        <div id="sku-management" class="page-content">
            <div class="page-header">
                <h1>SKUìƒí’ˆê´€ë¦¬</h1>
                <p>SKU ìƒí’ˆê³¼ êµ¬ì„±í’ˆì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="card">
                <div class="card-title">
                    <span>SKU ìƒí’ˆ ëª©ë¡</span>
                    <button class="btn btn-primary" onclick="openAddSkuModal()">+ ìƒí’ˆ ì¶”ê°€</button>
                </div>
                <div class="table-container" id="sku-table"></div>
            </div>
        </div>

        <!-- ê±°ë˜ì²˜ë³„ ìƒí’ˆê´€ë¦¬ -->
        <div id="vendor-mapping" class="page-content">
            <div class="page-header">
                <h1>ê±°ë˜ì²˜ë³„ ìƒí’ˆê´€ë¦¬</h1>
                <p>ê±°ë˜ì²˜ ìƒí’ˆëª…ê³¼ SKU ë§¤í•‘ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="card">
                <div class="card-title">
                    <span>ê±°ë˜ì²˜ ë§¤í•‘</span>
                    <button class="btn btn-primary" onclick="openAddMappingModal()">+ ë§¤í•‘ ì¶”ê°€</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ê±°ë˜ì²˜ ì„ íƒ</label>
                        <select id="vendor-filter" onchange="loadVendorMappings()">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                </div>
                <div class="table-container" id="vendor-mapping-table"></div>
            </div>
        </div>

        <!-- ê±°ë˜ì²˜ë³„ íƒë°°ê´€ë¦¬ -->
        <div id="vendor-delivery" class="page-content">
            <div class="page-header">
                <h1>ê±°ë˜ì²˜ë³„ íƒë°°ê´€ë¦¬</h1>
                <p>ê±°ë˜ì²˜ë³„ ì—‘ì…€ í…œí”Œë¦¿ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="card">
                <div class="card-title">ê±°ë˜ì²˜ í…œí”Œë¦¿ ì„¤ì •</div>
                <div class="table-container" id="vendor-template-table"></div>
            </div>
        </div>

        <!-- ë°œì£¼ì„œ ë³€í™˜ (ì‚¬ìš©ìë³„) -->
        <div id="convert" class="page-content">
            <div class="page-header">
                <h1>ë°œì£¼ì„œ ë³€í™˜</h1>
                <p id="convert-user-info">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
            </div>

            <div class="card">
                <div class="card-title">ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ë°œì£¼ì²˜ ì„ íƒ</label>
                        <select id="vendor-name">
                            <option value="">ë°œì£¼ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                </div>
                <div class="upload-area" id="upload-area">
                    <input type="file" id="file-input" accept=".xlsx,.xls" multiple>
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
                </div>
                <div id="file-info" class="status success"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" id="btn-convert" onclick="convertOrders()" disabled>ë³€í™˜í•˜ê¸°</button>
                </div>
            </div>

            <div class="card" id="convert-result" style="display: none;">
                <div class="card-title">
                    <span>ë³€í™˜ ê²°ê³¼</span>
                    <span id="convert-result-summary"></span>
                </div>
                <div class="table-container" id="convert-result-table"></div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="confirmConvertedData()">ë³€í™˜í™•ì •ìœ¼ë¡œ ì´ë™</button>
                </div>
            </div>
        </div>

        <!-- ë³€í™˜í™•ì • (ì‚¬ìš©ìë³„) -->
        <div id="confirmed" class="page-content">
            <div class="page-header">
                <h1>ë³€í™˜í™•ì •</h1>
                <p id="confirmed-user-info">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
            </div>

            <div class="card">
                <div class="card-title">
                    <span>í™•ì • ëŒ€ê¸° ëª©ë¡</span>
                    <span class="badge" id="confirmed-badge">0</span>
                </div>
                <div class="result-summary" id="confirmed-summary"></div>
                <div class="table-container" id="confirmed-table"></div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="registerOrders()">ì „ì²´ì£¼ë¬¸ê´€ë¦¬ë¡œ ë“±ë¡</button>
                    <button class="btn btn-primary" onclick="downloadConfirmedExcel()">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
        </div>

        <!-- ì „ì²´ì£¼ë¬¸ê´€ë¦¬ (ì‚¬ìš©ìë³„) -->
        <div id="order-management" class="page-content">
            <div class="page-header">
                <h1>ì „ì²´ì£¼ë¬¸ê´€ë¦¬</h1>
                <p id="order-user-info">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
            </div>

            <div class="card">
                <div class="card-title">
                    <span>ì£¼ë¬¸ ëª©ë¡</span>
                    <span class="badge" id="order-badge">0</span>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ê¸°ê°„</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="date" id="order-date-from" style="flex: 1;">
                            <span>~</span>
                            <input type="date" id="order-date-to" style="flex: 1;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ìƒíƒœ</label>
                        <select id="order-status-filter">
                            <option value="">ì „ì²´</option>
                            <option value="pending">ë¯¸ì¶œê³ </option>
                            <option value="shipped">ì¶œê³ ì™„ë£Œ</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 0;">
                        <label>&nbsp;</label>
                        <button class="btn btn-secondary" onclick="loadUserOrders()">í•„í„° ì ìš©</button>
                    </div>
                </div>
                <div class="result-summary" id="order-summary"></div>
                <div class="table-container" id="order-table"></div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="bulkUpdateStatus('shipped', true)">ì„ íƒ ì¶œê³ ì™„ë£Œ</button>
                    <button class="btn btn-primary" onclick="bulkUpdateStatus('paid', true)">ì„ íƒ ì…ê¸ˆì™„ë£Œ</button>
                    <button class="btn btn-warning" onclick="downloadOrderExcel()">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë‚ ì§œ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal" id="day-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 id="day-modal-title">ë‚ ì§œ ìƒì„¸</h3>
                <button class="modal-close" onclick="closeDayModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="day-orders-list"></div>
                <div class="btn-group" style="margin-top: 16px;">
                    <button class="btn btn-success" onclick="calculateDayOrder()">ë°œì£¼ëŸ‰ ê³„ì‚°</button>
                </div>
                <div id="day-calculation-result"></div>
            </div>
        </div>
    </div>

    <!-- ì‚¬ìš©ì ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal" id="user-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>ì‚¬ìš©ì ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ì‚¬ìš©ì ì´ë¦„</label>
                    <input type="text" id="new-user-name" placeholder="ì˜ˆ: í™ê¸¸ë™">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeUserModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="addUser()">ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <!-- ë¶€ìœ„ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal" id="part-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>ë¶€ìœ„ ì¶”ê°€/ìˆ˜ì •</h3>
                <button class="modal-close" onclick="closePartModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ë¶€ìœ„ëª…</label>
                    <input type="text" id="part-name" placeholder="ì˜ˆ: ë“±ì‹¬">
                </div>
                <div class="form-group">
                    <label>100gë‹¹ ì›ê°€ (ì›)</label>
                    <input type="number" id="part-price" placeholder="ì˜ˆ: 7800">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePartModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="savePart()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- í¬ì¥ì¬ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal" id="packaging-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>í¬ì¥ì¬ ì¶”ê°€/ìˆ˜ì •</h3>
                <button class="modal-close" onclick="closePackagingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>í¬ì¥ì¬ëª…</label>
                    <input type="text" id="packaging-name" placeholder="ì˜ˆ: ì„ ë¬¼í¬ì¥">
                </div>
                <div class="form-group">
                    <label>ê°€ê²© (ì›)</label>
                    <input type="number" id="packaging-price" placeholder="ì˜ˆ: 5000">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePackagingModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="savePackaging()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- SKU ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="sku-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="sku-modal-title">SKU ìƒí’ˆ ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeSkuModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>ìƒí’ˆëª…</label>
                        <input type="text" id="sku-name" placeholder="ì˜ˆ: í•œìš° ë“±ì‹¬ ì„¸íŠ¸ 1kg">
                    </div>
                    <div class="form-group">
                        <label>í¬ì¥ì¬</label>
                        <select id="sku-packaging"></select>
                    </div>
                    <div class="form-group">
                        <label>íŒë§¤ê°€ê²© (ì›)</label>
                        <input type="number" id="sku-price" placeholder="ì˜ˆ: 89000">
                    </div>
                </div>
                <div style="margin-top: 16px;">
                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">êµ¬ì„±í’ˆ</label>
                    <div id="composition-list"></div>
                    <button class="btn btn-secondary btn-small" onclick="addCompositionRow()">+ êµ¬ì„±í’ˆ ì¶”ê°€</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSkuModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveSku()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ë§¤í•‘ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal" id="mapping-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>ê±°ë˜ì²˜ ë§¤í•‘ ì¶”ê°€</h3>
                <button class="modal-close" onclick="closeMappingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ê±°ë˜ì²˜ëª…</label>
                    <input type="text" id="mapping-vendor" placeholder="ì˜ˆ: ì •ë§ˆì¸í‘¸ë“œ">
                </div>
                <div class="form-group">
                    <label>ìƒí’ˆì½”ë“œ</label>
                    <input type="text" id="mapping-code" placeholder="ì˜ˆ: JM-001">
                </div>
                <div class="form-group">
                    <label>ê±°ë˜ì²˜ ìƒí’ˆëª…</label>
                    <input type="text" id="mapping-product-name" placeholder="ì˜ˆ: ë“±ì‹¬ì„¸íŠ¸(1kg)">
                </div>
                <div class="form-group">
                    <label>SKU ìƒí’ˆ</label>
                    <select id="mapping-sku"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMappingModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveMapping()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p style="margin-top: 16px;">ì²˜ë¦¬ ì¤‘...</p>
    </div>

    <!-- í† ìŠ¤íŠ¸ -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // ==================== ì „ì—­ ë³€ìˆ˜ ====================
        let currentUser = null;
        let userList = [];
        let allUsersData = {};
        let skuProducts = [];
        let partsData = {};
        let packagingData = {};
        let vendorMappings = [];
        let calendarData = {};
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();
        let selectedDate = null;
        let editingSkuId = null;

        // ì„œë²„ì—ì„œ ë¯¸ë¦¬ ë¡œë“œí•œ ì´ˆê¸° ë°ì´í„° (SSR)
        const INIT_DATA = {"users": [{"id": 1, "name": "\uae40\ubbfc\uc11c", "role": "admin"}, {"id": 2, "name": "\ubc15\uc9c0\uc601", "role": "user"}, {"id": 3, "name": "\uc774\uc900\ud601", "role": "user"}], "parts": [{"id": 7, "part_name": "\uac08\ube44", "price_per_100g": 6800, "cost_type": "weight"}, {"id": 2, "part_name": "\ub4f1\uc2ec", "price_per_100g": 7800, "cost_type": "weight"}, {"id": 4, "part_name": "\ubaa9\uc2ec", "price_per_100g": 5500, "cost_type": "weight"}, {"id": 14, "part_name": "\uc0ac\ud0dc", "price_per_100g": 3800, "cost_type": "weight"}, {"id": 1, "part_name": "\uc548\uc2ec", "price_per_100g": 8500, "cost_type": "weight"}, {"id": 13, "part_name": "\uc591\uc9c0", "price_per_100g": 4200, "cost_type": "weight"}, {"id": 3, "part_name": "\ucc44\ub05d", "price_per_100g": 7200, "cost_type": "weight"}, {"id": 6, "part_name": "\ub4b7\ub2e4\ub9ac", "price_per_100g": 4500, "cost_type": "weight"}, {"id": 8, "part_name": "\uc0bc\uacb9\uc0b4", "price_per_100g": 5200, "cost_type": "weight"}, {"id": 5, "part_name": "\uc55e\ub2e4\ub9ac", "price_per_100g": 4800, "cost_type": "weight"}, {"id": 15, "part_name": "\uc6b0\uc0bc\uacb9", "price_per_100g": 4500, "cost_type": "weight"}, {"id": 11, "part_name": "\ud1a0\uc2dc\uc0b4", "price_per_100g": 6200, "cost_type": "weight"}, {"id": 9, "part_name": "\ud56d\uc815\uc0b4", "price_per_100g": 7000, "cost_type": "weight"}, {"id": 10, "part_name": "\uac00\ube0c\ub9ac\uc0b4", "price_per_100g": 6500, "cost_type": "weight"}, {"id": 12, "part_name": "\ucc28\ub3cc\ubc15\uc774", "price_per_100g": 5800, "cost_type": "weight"}], "packaging": [{"id": 2, "packaging_name": "\ubcf4\ub0c9\ubc31", "price": 2000}, {"id": 1, "packaging_name": "\ubc15\uc2a4\ud3ec\uc7a5", "price": 3000}, {"id": 7, "packaging_name": "\uc120\ubb3c\ud3ec\uc7a5", "price": 5000}, {"id": 6, "packaging_name": "\uc9c4\uacf5\ud3ec\uc7a5", "price": 1500}, {"id": 5, "packaging_name": "\uc2a4\ud2f0\ub85c\ud3fc\ubc15\uc2a4", "price": 4000}, {"id": 4, "packaging_name": "\uc544\uc774\uc2a4\ud329(\ub300)", "price": 1000}, {"id": 3, "packaging_name": "\uc544\uc774\uc2a4\ud329(\uc18c)", "price": 500}], "sku_products": [{"id": 5, "sku_name": "\ud55c\uc6b0 \ubaa8\ub460 \uad6c\uc774\uc138\ud2b8 1.5kg", "packaging": "\uc120\ubb3c\ud3ec\uc7a5", "selling_price": 120000, "compositions": [{"id": 6, "part_name": "\ub4f1\uc2ec", "weight": 500, "composition_type": "weight"}, {"id": 7, "part_name": "\ucc44\ub05d", "weight": 500, "composition_type": "weight"}, {"id": 8, "part_name": "\uc548\uc2ec", "weight": 500, "composition_type": "weight"}]}, {"id": 8, "sku_name": "\ud55c\uc6b0 \uc0ac\ud0dc \uc218\uc721\uc6a9 1kg", "packaging": "\uc9c4\uacf5\ud3ec\uc7a5", "selling_price": 48000, "compositions": [{"id": 11, "part_name": "\uc0ac\ud0dc", "weight": 1000, "composition_type": "weight"}]}, {"id": 1, "sku_name": "\ud55c\uc6b0 \ub4f1\uc2ec \uc138\ud2b8 1kg", "packaging": "\uc120\ubb3c\ud3ec\uc7a5", "selling_price": 89000, "compositions": [{"id": 1, "part_name": "\ub4f1\uc2ec", "weight": 1000, "composition_type": "weight"}]}, {"id": 4, "sku_name": "\ud55c\uc6b0 \uac08\ube44 \uc120\ubb3c\uc138\ud2b8 2kg", "packaging": "\uc120\ubb3c\ud3ec\uc7a5", "selling_price": 180000, "compositions": [{"id": 5, "part_name": "\uac08\ube44", "weight": 2000, "composition_type": "weight"}]}, {"id": 6, "sku_name": "\ud55c\uc6b0 \ucc28\ub3cc\ubc15\uc774 300g", "packaging": "\uc9c4\uacf5\ud3ec\uc7a5", "selling_price": 25000, "compositions": [{"id": 9, "part_name": "\ucc28\ub3cc\ubc15\uc774", "weight": 300, "composition_type": "weight"}]}, {"id": 9, "sku_name": "\ud55c\uc6b0 \ud2b9\uc120 \ubaa8\ub460 3kg", "packaging": "\uc2a4\ud2f0\ub85c\ud3fc\ubc15\uc2a4", "selling_price": 250000, "compositions": [{"id": 12, "part_name": "\ub4f1\uc2ec", "weight": 800, "composition_type": "weight"}, {"id": 13, "part_name": "\uc548\uc2ec", "weight": 600, "composition_type": "weight"}, {"id": 14, "part_name": "\ucc44\ub05d", "weight": 600, "composition_type": "weight"}, {"id": 15, "part_name": "\uac08\ube44", "weight": 1000, "composition_type": "weight"}]}, {"id": 10, "sku_name": "\ud55c\uc6b0 \ud56d\uc815\uc0b4 400g", "packaging": "\uc9c4\uacf5\ud3ec\uc7a5", "selling_price": 38000, "compositions": [{"id": 16, "part_name": "\ud56d\uc815\uc0b4", "weight": 400, "composition_type": "weight"}]}, {"id": 2, "sku_name": "\ud55c\uc6b0 \uc548\uc2ec \uc2a4\ud14c\uc774\ud06c 500g", "packaging": "\uc9c4\uacf5\ud3ec\uc7a5", "selling_price": 55000, "compositions": [{"id": 2, "part_name": "\uc548\uc2ec", "weight": 500, "composition_type": "weight"}]}, {"id": 7, "sku_name": "\ud55c\uc6b0 \uc591\uc9c0 \uad6d\uac70\ub9ac 500g", "packaging": "\ubc15\uc2a4\ud3ec\uc7a5", "selling_price": 28000, "compositions": [{"id": 10, "part_name": "\uc591\uc9c0", "weight": 500, "composition_type": "weight"}]}, {"id": 3, "sku_name": "\ud55c\uc6b0 \ubd88\uace0\uae30\uc6a9 600g", "packaging": "\ubc15\uc2a4\ud3ec\uc7a5", "selling_price": 42000, "compositions": [{"id": 3, "part_name": "\uc55e\ub2e4\ub9ac", "weight": 300, "composition_type": "weight"}, {"id": 4, "part_name": "\ubaa9\uc2ec", "weight": 300, "composition_type": "weight"}]}], "vendor_mappings": [{"id": 8, "vendor_name": "\ubbf8\ud2b8\ub7a9", "product_code": "ML-101", "product_name": "\uc0ac\ud0dc\uc218\uc721", "sku_product_id": 8, "sku_name": "\ud55c\uc6b0 \uc0ac\ud0dc \uc218\uc721\uc6a9 1kg"}, {"id": 7, "vendor_name": "\ubbf8\ud2b8\ub7a9", "product_code": "ML-100", "product_name": "\uc591\uc9c0\uad6d\uac70\ub9ac", "sku_product_id": 7, "sku_name": "\ud55c\uc6b0 \uc591\uc9c0 \uad6d\uac70\ub9ac 500g"}, {"id": 11, "vendor_name": "\uace0\uae30\ub098\ub77c", "product_code": "GN-01", "product_name": "\ub4f1\uc2ec1kg", "sku_product_id": 1, "sku_name": "\ud55c\uc6b0 \ub4f1\uc2ec \uc138\ud2b8 1kg"}, {"id": 12, "vendor_name": "\uace0\uae30\ub098\ub77c", "product_code": "GN-02", "product_name": "\uac08\ube442kg", "sku_product_id": 4, "sku_name": "\ud55c\uc6b0 \uac08\ube44 \uc120\ubb3c\uc138\ud2b8 2kg"}, {"id": 9, "vendor_name": "\ud55c\uc6b0\ub9c8\uc744", "product_code": "HW-SP1", "product_name": "\ud2b9\uc120\ubaa8\ub4603kg", "sku_product_id": 9, "sku_name": "\ud55c\uc6b0 \ud2b9\uc120 \ubaa8\ub460 3kg"}, {"id": 10, "vendor_name": "\ud55c\uc6b0\ub9c8\uc744", "product_code": "HW-SP2", "product_name": "\ud56d\uc815\uc0b4400", "sku_product_id": 10, "sku_name": "\ud55c\uc6b0 \ud56d\uc815\uc0b4 400g"}, {"id": 4, "vendor_name": "\ud611\uc2e0\ucd95\uc0b0", "product_code": "HS-A01", "product_name": "\uac08\ube44\uc120\ubb3c\uc138\ud2b8", "sku_product_id": 4, "sku_name": "\ud55c\uc6b0 \uac08\ube44 \uc120\ubb3c\uc138\ud2b8 2kg"}, {"id": 5, "vendor_name": "\ud611\uc2e0\ucd95\uc0b0", "product_code": "HS-A02", "product_name": "\ubaa8\ub460\uad6c\uc7741.5", "sku_product_id": 5, "sku_name": "\ud55c\uc6b0 \ubaa8\ub460 \uad6c\uc774\uc138\ud2b8 1.5kg"}, {"id": 6, "vendor_name": "\ud611\uc2e0\ucd95\uc0b0", "product_code": "HS-A03", "product_name": "\ucc28\ub3cc300", "sku_product_id": 6, "sku_name": "\ud55c\uc6b0 \ucc28\ub3cc\ubc15\uc774 300g"}, {"id": 3, "vendor_name": "\uc815\ub9c8\uc778\ud478\ub4dc", "product_code": "JM-003", "product_name": "\ubd88\uace0\uae30\uc14b\ud2b8", "sku_product_id": 3, "sku_name": "\ud55c\uc6b0 \ubd88\uace0\uae30\uc6a9 600g"}, {"id": 2, "vendor_name": "\uc815\ub9c8\uc778\ud478\ub4dc", "product_code": "JM-002", "product_name": "\uc548\uc2ec\uc2a4\ud14c\uc774\ud06c", "sku_product_id": 2, "sku_name": "\ud55c\uc6b0 \uc548\uc2ec \uc2a4\ud14c\uc774\ud06c 500g"}, {"id": 1, "vendor_name": "\uc815\ub9c8\uc778\ud478\ub4dc", "product_code": "JM-001", "product_name": "\ub4f1\uc2ec\uc138\ud2b8(1kg)", "sku_product_id": 1, "sku_name": "\ud55c\uc6b0 \ub4f1\uc2ec \uc138\ud2b8 1kg"}], "calendar": {"2026-02-01": {"order_count": 7, "total_qty": 13}, "2026-02-02": {"order_count": 6, "total_qty": 12}, "2026-02-03": {"order_count": 1, "total_qty": 1}}, "year": 2026, "month": 2};

        // ==================== ì´ˆê¸°í™” ====================
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });

        function initializeApp() {
            const debugEl = document.getElementById('calendar-title');
            try {
                debugEl.textContent = 'ì´ˆê¸°í™” ì‹œì‘...';

                // ì„œë²„ì—ì„œ ë¯¸ë¦¬ ë¡œë“œí•œ ë°ì´í„° ì‚¬ìš© (SSR - API í˜¸ì¶œ ì—†ìŒ!)
                const data = INIT_DATA;

                if (!data || data.error) {
                    debugEl.textContent = 'ERROR: ë°ì´í„° ì—†ìŒ';
                    updateConnectionStatus(false);
                    return;
                }

                debugEl.textContent = 'ë°ì´í„° ë¡œë“œë¨...';
                updateConnectionStatus(true);

                // ë°ì´í„° ì €ì¥
                userList = data.users || [];
                if (userList.length > 0 && !currentUser) {
                    currentUser = userList[0].name;
                }

                partsData = {};
                (data.parts || []).forEach(p => {
                    partsData[p.part_name] = { price: p.price_per_100g, type: p.cost_type };
                });

                packagingData = {};
                (data.packaging || []).forEach(p => {
                    packagingData[p.packaging_name] = p.price;
                });

                skuProducts = data.sku_products || [];
                vendorMappings = data.vendor_mappings || [];
                calendarData = data.calendar || {};
                currentYear = data.year || new Date().getFullYear();
                currentMonth = (data.month || new Date().getMonth() + 1) - 1;

                debugEl.textContent = 'UI ë Œë”ë§ ì‹œì‘...';

                // UI ë Œë”ë§ (ë™ê¸°)
                try { renderUserMenus(); } catch(e) { debugEl.textContent = 'ERROR: renderUserMenus - ' + e.message; return; }
                try { renderCalendarWithData(calendarData); } catch(e) { debugEl.textContent = 'ERROR: renderCalendar - ' + e.message; return; }
                try { renderPartsTable(); } catch(e) { console.error('renderPartsTable', e); }
                try { renderPackagingTable(); } catch(e) { console.error('renderPackagingTable', e); }
                try { renderSkuTable(); } catch(e) { console.error('renderSkuTable', e); }
                try { renderVendorMappingTable(); } catch(e) { console.error('renderVendorMappingTable', e); }
                try { updateVendorSelect(); } catch(e) { console.error('updateVendorSelect', e); }
                try { updateVendorFilterSelect(); } catch(e) { console.error('updateVendorFilterSelect', e); }
                try { updateIntegratedUserFilter(); } catch(e) { console.error('updateIntegratedUserFilter', e); }
                try { updatePackagingSelect(); } catch(e) { console.error('updatePackagingSelect', e); }
                try { updateSkuSelect(); } catch(e) { console.error('updateSkuSelect', e); }

            } catch (e) {
                console.error('Initialize error:', e);
                if (debugEl) debugEl.textContent = 'INIT ERROR: ' + e.message;
                updateConnectionStatus(false);
            }
        }

        // ==================== API í˜¸ì¶œ ====================
        async function loadUsers() {
            const res = await fetch('/api/users');
            const data = await res.json();
            userList = data.users || [];
            if (userList.length > 0 && !currentUser) {
                currentUser = userList[0].name;
            }
            updateIntegratedUserFilter();
        }

        async function loadPartsData() {
            const res = await fetch('/api/parts-cost');
            const data = await res.json();
            partsData = {};
            (data.parts || []).forEach(p => {
                partsData[p.part_name] = { price: p.price_per_100g, type: p.cost_type };
            });
            renderPartsTable();
        }

        async function loadPackagingData() {
            const res = await fetch('/api/packaging-cost');
            const data = await res.json();
            packagingData = {};
            (data.packaging || []).forEach(p => {
                packagingData[p.packaging_name] = p.price;
            });
            renderPackagingTable();
            updatePackagingSelect();
        }

        async function loadSkuProducts() {
            const res = await fetch('/api/sku-products');
            const data = await res.json();
            skuProducts = data.products || [];
            renderSkuTable();
            updateSkuSelect();
        }

        async function loadVendorMappingsAll() {
            const res = await fetch('/api/vendor-mappings');
            const data = await res.json();
            vendorMappings = data.mappings || [];
            renderVendorMappingTable();
            updateVendorFilterSelect();
        }

        async function loadCalendarData() {
            const res = await fetch(`/api/dashboard/calendar?year=${currentYear}&month=${currentMonth + 1}`);
            const data = await res.json();
            return data.calendar || {};
        }

        async function loadIntegratedOrders() {
            showLoading();
            const userId = document.getElementById('integrated-user-filter').value;
            const dateFrom = document.getElementById('integrated-date-from').value;
            const dateTo = document.getElementById('integrated-date-to').value;
            const status = document.getElementById('integrated-status-filter').value;

            let url = '/api/integrated-orders?limit=500';
            if (userId) url += `&user_id=${userId}`;
            if (dateFrom) url += `&date_from=${dateFrom}`;
            if (dateTo) url += `&date_to=${dateTo}`;
            if (status === 'pending') url += '&shipped=false';
            if (status === 'shipped') url += '&shipped=true';

            const res = await fetch(url);
            const data = await res.json();
            renderIntegratedOrders(data.orders || [], data.stats || {});
            hideLoading();
        }

        // ==================== ë Œë”ë§ ====================
        function renderUserMenus() {
            const container = document.getElementById('user-menus');
            if (!container) return;

            container.innerHTML = userList.map(user => `
                <div class="user-dropdown">
                    <div class="user-dropdown-header ${currentUser === user.name ? 'active' : ''}"
                         onclick="toggleUserMenu('${user.name}')">
                        <span class="user-name">
                            <span class="icon">ğŸ‘¤</span> ${escapeHtml(user.name)}
                        </span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div class="user-dropdown-menu" id="user-menu-${user.id}">
                        <div class="menu-item" onclick="showUserPage('convert', '${user.name}', ${user.id})">
                            <span class="icon">ğŸ“¥</span> ë°œì£¼ì„œ ë³€í™˜
                        </div>
                        <div class="menu-item" onclick="showUserPage('confirmed', '${user.name}', ${user.id})">
                            <span class="icon">âœ…</span> ë³€í™˜í™•ì •
                            <span class="badge" id="badge-confirmed-${user.id}" style="display:none;">0</span>
                        </div>
                        <div class="menu-item" onclick="showUserPage('order-management', '${user.name}', ${user.id})">
                            <span class="icon">ğŸ“‹</span> ì „ì²´ì£¼ë¬¸ê´€ë¦¬
                            <span class="badge" id="badge-order-${user.id}" style="display:none;">0</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleUserMenu(userName) {
            currentUser = userName;
            const user = userList.find(u => u.name === userName);
            if (!user) return;

            // ëª¨ë“  ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.querySelectorAll('.user-dropdown-header').forEach(el => {
                el.classList.remove('expanded', 'active');
            });
            document.querySelectorAll('.user-dropdown-menu').forEach(el => {
                el.classList.remove('show');
            });

            // ì„ íƒí•œ ë“œë¡­ë‹¤ìš´ ì—´ê¸°
            const header = document.querySelector(`.user-dropdown-header[onclick="toggleUserMenu('${userName}')"]`);
            const menu = document.getElementById(`user-menu-${user.id}`);
            if (header && menu) {
                header.classList.add('expanded', 'active');
                menu.classList.add('show');
            }
        }

        // ì´ë¯¸ ë¡œë“œëœ ë°ì´í„°ë¡œ ë‹¬ë ¥ ë Œë”ë§ (ì´ˆê¸° ë¡œë“œìš©)
        function renderCalendarWithData(data) {
            calendarData = data;
            renderCalendarInternal(data);
        }

        // ì›” ë³€ê²½ ì‹œ ìƒˆë¡œ ë°ì´í„° ë¡œë“œ
        async function renderCalendar() {
            showLoading();
            const data = await loadCalendarData();
            calendarData = data;
            renderCalendarInternal(data);
            hideLoading();
        }

        // ì‹¤ì œ ë‹¬ë ¥ ë Œë”ë§
        function renderCalendarInternal(data) {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const prevLastDay = new Date(currentYear, currentMonth, 0);
            const firstDayOfWeek = firstDay.getDay();
            const lastDate = lastDay.getDate();
            const prevLastDate = prevLastDay.getDate();

            document.getElementById('calendar-title').textContent = `${currentYear}ë…„ ${currentMonth + 1}ì›”`;

            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';

            // ìš”ì¼ í—¤ë”
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            days.forEach((day, index) => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                if (index === 0) header.classList.add('sunday');
                if (index === 6) header.classList.add('saturday');
                header.textContent = day;
                grid.appendChild(header);
            });

            // ì´ì „ ë‹¬
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevLastDate - i;
                const cell = createDayCell(currentYear, currentMonth - 1, day, true, data);
                grid.appendChild(cell);
            }

            // í˜„ì¬ ë‹¬
            for (let day = 1; day <= lastDate; day++) {
                const cell = createDayCell(currentYear, currentMonth, day, false, data);
                grid.appendChild(cell);
            }

            // ë‹¤ìŒ ë‹¬
            const totalCells = grid.children.length - 7;
            const remainingCells = 42 - totalCells;
            for (let day = 1; day <= remainingCells; day++) {
                const cell = createDayCell(currentYear, currentMonth + 1, day, true, data);
                grid.appendChild(cell);
            }
        }

        function createDayCell(year, month, day, isOtherMonth, calendarData) {
            const cell = document.createElement('div');
            cell.className = 'calendar-day';

            const date = new Date(year, month, day);
            const dateKey = formatDateKey(date);
            const dayOfWeek = date.getDay();

            if (isOtherMonth) cell.classList.add('other-month');
            if (dayOfWeek === 0) cell.classList.add('sunday');
            if (dayOfWeek === 6) cell.classList.add('saturday');

            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                cell.classList.add('today');
            }

            const numberDiv = document.createElement('div');
            numberDiv.className = 'calendar-day-number';
            numberDiv.textContent = day;
            cell.appendChild(numberDiv);

            const ordersDiv = document.createElement('div');
            ordersDiv.className = 'calendar-day-orders';

            const dayData = calendarData[dateKey];
            if (dayData && dayData.order_count > 0) {
                ordersDiv.innerHTML = `<span class="calendar-order-count">${dayData.order_count}ê±´ (${dayData.total_qty}ê°œ)</span>`;
            }

            cell.appendChild(ordersDiv);
            cell.onclick = () => openDayModal(dateKey);

            return cell;
        }

        function formatDateKey(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function renderPartsTable() {
            const container = document.getElementById('parts-table');
            if (!container) return;

            const parts = Object.entries(partsData);
            if (parts.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">ë“±ë¡ëœ ë¶€ìœ„ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ë¶€ìœ„ëª…</th>
                            <th>100gë‹¹ ì›ê°€</th>
                            <th>íƒ€ì…</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${parts.map(([name, data]) => `
                            <tr>
                                <td>${escapeHtml(name)}</td>
                                <td>${(data.price || 0).toLocaleString()}ì›</td>
                                <td>${data.type === 'unit' ? 'ê°œìˆ˜' : 'ì¤‘ëŸ‰'}</td>
                                <td>
                                    <button class="btn btn-danger btn-small" onclick="deletePart('${escapeHtml(name)}')">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderPackagingTable() {
            const container = document.getElementById('packaging-table');
            if (!container) return;

            const pkgs = Object.entries(packagingData);
            if (pkgs.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">ë“±ë¡ëœ í¬ì¥ì¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>í¬ì¥ì¬ëª…</th>
                            <th>ê°€ê²©</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${pkgs.map(([name, price]) => `
                            <tr>
                                <td>${escapeHtml(name)}</td>
                                <td>${price.toLocaleString()}ì›</td>
                                <td>
                                    <button class="btn btn-danger btn-small" onclick="deletePackaging('${escapeHtml(name)}')">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderSkuTable() {
            const container = document.getElementById('sku-table');
            if (!container) return;

            if (skuProducts.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">ë“±ë¡ëœ SKU ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ìƒí’ˆëª…</th>
                            <th>í¬ì¥ì¬</th>
                            <th>íŒë§¤ê°€ê²©</th>
                            <th>êµ¬ì„±í’ˆ</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${skuProducts.map(sku => {
                            const compText = (sku.compositions || []).map(c =>
                                `${c.part_name} ${c.weight}g`
                            ).join(', ') || '-';
                            return `
                                <tr>
                                    <td>${escapeHtml(sku.sku_name)}</td>
                                    <td>${escapeHtml(sku.packaging || '-')}</td>
                                    <td>${(sku.selling_price || 0).toLocaleString()}ì›</td>
                                    <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis;">${escapeHtml(compText)}</td>
                                    <td>
                                        <button class="btn btn-primary btn-small" onclick="editSku(${sku.id})">ìˆ˜ì •</button>
                                        <button class="btn btn-danger btn-small" onclick="deleteSku(${sku.id})">ì‚­ì œ</button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderVendorMappingTable() {
            const container = document.getElementById('vendor-mapping-table');
            if (!container) return;

            const vendor = document.getElementById('vendor-filter')?.value || '';
            const filtered = vendor ? vendorMappings.filter(m => m.vendor_name === vendor) : vendorMappings;

            if (filtered.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">ë“±ë¡ëœ ë§¤í•‘ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ê±°ë˜ì²˜</th>
                            <th>ìƒí’ˆì½”ë“œ</th>
                            <th>ê±°ë˜ì²˜ ìƒí’ˆëª…</th>
                            <th>ë§¤ì¹­ SKU</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered.map(m => `
                            <tr>
                                <td>${escapeHtml(m.vendor_name)}</td>
                                <td>${escapeHtml(m.product_code || '-')}</td>
                                <td>${escapeHtml(m.product_name || '-')}</td>
                                <td>${escapeHtml(m.sku_name || 'ë¯¸ë§¤ì¹­')}</td>
                                <td>
                                    <button class="btn btn-danger btn-small" onclick="deleteMapping(${m.id})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function renderIntegratedOrders(orders, stats) {
            const summaryEl = document.getElementById('integrated-summary');
            const tableEl = document.getElementById('integrated-table');

            summaryEl.innerHTML = `
                <div class="summary-item"><span class="label">ì „ì²´:</span><span class="value">${stats.total || 0}ê±´</span></div>
                <div class="summary-item"><span class="label">ì¶œê³ ì™„ë£Œ:</span><span class="value">${stats.shipped_count || 0}ê±´</span></div>
                <div class="summary-item"><span class="label">ì…ê¸ˆì™„ë£Œ:</span><span class="value">${stats.paid_count || 0}ê±´</span></div>
            `;

            if (orders.length === 0) {
                tableEl.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">ì¡°íšŒëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            tableEl.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ì¶œê³ ì¼</th>
                            <th>ë‹´ë‹¹ì</th>
                            <th>ê±°ë˜ì²˜</th>
                            <th>SKU</th>
                            <th>ìˆ˜ëŸ‰</th>
                            <th>ìˆ˜ë ¹ì¸</th>
                            <th>ì¶œê³ </th>
                            <th>ì…ê¸ˆ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${orders.map(o => `
                            <tr>
                                <td>${o.release_date ? new Date(o.release_date).toLocaleDateString('ko-KR') : '-'}</td>
                                <td>${escapeHtml(o.user_name || '-')}</td>
                                <td>${escapeHtml(o.vendor_name || '-')}</td>
                                <td>${escapeHtml(o.sku_name || '-')}</td>
                                <td>${o.quantity}</td>
                                <td>${escapeHtml(o.recipient || '-')}</td>
                                <td><span class="status-badge ${o.shipped ? 'shipped' : 'not-shipped'}">${o.shipped ? 'ì¶œê³ ' : 'ë¯¸ì¶œê³ '}</span></td>
                                <td><span class="status-badge ${o.paid ? 'paid' : 'not-paid'}">${o.paid ? 'ì…ê¸ˆ' : 'ë¯¸ì…ê¸ˆ'}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // ==================== ê¸°ê°„ë³„ ë°œì£¼ëŸ‰ ê³„ì‚° ====================
        async function calculateRangeOrder() {
            const startStr = document.getElementById('range-start').value;
            const endStr = document.getElementById('range-end').value;

            if (!startStr || !endStr) {
                showToast('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            showLoading();
            const res = await fetch(`/api/dashboard/range-orders?start=${startStr}&end=${endStr}`);
            const data = await res.json();
            hideLoading();

            const skuSummary = data.sku_summary || [];
            if (skuSummary.length === 0) {
                document.getElementById('range-result').innerHTML = '<div class="status show info">ì„ íƒí•œ ê¸°ê°„ì— ë“±ë¡ëœ ë°°ì†¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let html = '<div class="result-box"><h3>ë°œì£¼ëŸ‰ ê³„ì‚° ê²°ê³¼</h3>';

            // ì£¼ë¬¸ ëª©ë¡
            html += '<h4>ì£¼ë¬¸ ëª©ë¡</h4>';
            html += `<table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="background: #f5f5f5;">
                        <th style="padding: 8px; border: 1px solid #ddd;">SKU</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">ì£¼ë¬¸ê±´ìˆ˜</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">ì´ìˆ˜ëŸ‰</th>
                    </tr>
                </thead>
                <tbody>
                    ${skuSummary.map(item => `
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;">${escapeHtml(item.sku_name || '-')}</td>
                            <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${item.order_count}ê±´</td>
                            <td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 600;">${item.total_qty}ê°œ</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>`;

            // ë¶€ìœ„ë³„ ì§‘ê³„ (SKU êµ¬ì„±í’ˆ ê¸°ë°˜)
            const partTotals = {};
            skuSummary.forEach(item => {
                const sku = skuProducts.find(s => s.sku_name === item.sku_name);
                if (sku && sku.compositions) {
                    sku.compositions.forEach(comp => {
                        const key = comp.part_name;
                        if (!partTotals[key]) {
                            partTotals[key] = { weight: 0, packs: 0 };
                        }
                        partTotals[key].weight += comp.weight * item.total_qty;
                        partTotals[key].packs += item.total_qty;
                    });
                }
            });

            if (Object.keys(partTotals).length > 0) {
                html += '<div style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 16px;">';

                // íŒ¨í‚¹ ìˆ˜ëŸ‰
                html += '<div style="flex: 1; min-width: 200px;">';
                html += '<h4>íŒ¨í‚¹ ìˆ˜ëŸ‰</h4>';
                html += `<table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 6px; border: 1px solid #ddd;">í’ˆëª©</th>
                            <th style="padding: 6px; border: 1px solid #ddd; text-align: center;">ìˆ˜ëŸ‰</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(partTotals).map(([part, data]) => `
                            <tr>
                                <td style="padding: 6px; border: 1px solid #ddd;">${escapeHtml(part)}</td>
                                <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 600;">${data.packs}íŒ©</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table></div>`;

                // ì´ ì¤‘ëŸ‰
                html += '<div style="flex: 1; min-width: 200px;">';
                html += '<h4>ì´ ì¤‘ëŸ‰</h4>';
                html += `<table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 6px; border: 1px solid #ddd;">í’ˆëª©</th>
                            <th style="padding: 6px; border: 1px solid #ddd; text-align: center;">kg</th>
                            <th style="padding: 6px; border: 1px solid #ddd; text-align: center;">g</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(partTotals).map(([part, data]) => `
                            <tr>
                                <td style="padding: 6px; border: 1px solid #ddd;">${escapeHtml(part)}</td>
                                <td style="padding: 6px; border: 1px solid #ddd; text-align: center; font-weight: 600;">${(data.weight / 1000).toFixed(2)}</td>
                                <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${data.weight.toLocaleString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table></div>';

                html += '</div>';
            }

            html += '</div>';
            document.getElementById('range-result').innerHTML = html;
        }

        // ==================== í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ====================
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));

            document.getElementById(pageId)?.classList.add('active');
            document.querySelector(`.menu-item[onclick="showPage('${pageId}')"]`)?.classList.add('active');

            // í˜ì´ì§€ë³„ ë°ì´í„° ë¡œë“œ
            if (pageId === 'integrated-view') loadIntegratedOrders();
            if (pageId === 'vendor-mapping') loadVendorMappings();
        }

        function showUserPage(pageId, userName, userId) {
            currentUser = userName;
            document.querySelectorAll('.page-content').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId)?.classList.add('active');

            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            if (pageId === 'convert') {
                document.getElementById('convert-user-info').textContent = `${userName}ë‹˜ì˜ ë°œì£¼ì„œ ë³€í™˜`;
            } else if (pageId === 'confirmed') {
                document.getElementById('confirmed-user-info').textContent = `${userName}ë‹˜ì˜ ë³€í™˜í™•ì • ëª©ë¡`;
                loadUserConfirmed(userId);
            } else if (pageId === 'order-management') {
                document.getElementById('order-user-info').textContent = `${userName}ë‹˜ì˜ ì „ì²´ì£¼ë¬¸ê´€ë¦¬`;
                loadUserOrders(userId);
            }
        }

        async function loadUserConfirmed(userId) {
            // TODO: ì‚¬ìš©ìë³„ í™•ì • ë°ì´í„° ë¡œë“œ
        }

        async function loadUserOrders(userId) {
            // TODO: ì‚¬ìš©ìë³„ ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ
        }

        // ==================== ëª¨ë‹¬ ====================
        function openDayModal(dateKey) {
            selectedDate = dateKey;
            const [year, month, day] = dateKey.split('-');
            document.getElementById('day-modal-title').textContent = `${year}ë…„ ${parseInt(month)}ì›” ${parseInt(day)}ì¼`;
            document.getElementById('day-orders-list').innerHTML = '<p style="color: #888;">ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
            document.getElementById('day-calculation-result').innerHTML = '';
            document.getElementById('day-modal').classList.add('show');

            loadDayOrders(dateKey);
        }

        async function loadDayOrders(dateKey) {
            const res = await fetch(`/api/integrated-orders?date_from=${dateKey}&date_to=${dateKey}&shipped=false`);
            const data = await res.json();
            const orders = data.orders || [];

            const container = document.getElementById('day-orders-list');
            if (orders.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center;">ë“±ë¡ëœ ë°°ì†¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            container.innerHTML = orders.map(o => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: ${o.shipped ? '#e8f5e9' : '#fff3e0'}; border-radius: 8px; margin-bottom: 8px;">
                    <div>
                        <div style="font-weight: 600;">${escapeHtml(o.vendor_name || '')} - ${escapeHtml(o.recipient || '')}</div>
                        <div style="color: #666; font-size: 13px;">${escapeHtml(o.sku_name || '')}</div>
                    </div>
                    <div style="font-weight: 700; font-size: 18px;">${o.quantity}</div>
                    <span class="status-badge ${o.shipped ? 'shipped' : 'not-shipped'}">${o.shipped ? 'ì¶œê³ ì™„ë£Œ' : 'ë¯¸ì¶œê³ '}</span>
                </div>
            `).join('');
        }

        function closeDayModal() {
            document.getElementById('day-modal').classList.remove('show');
            selectedDate = null;
        }

        async function calculateDayOrder() {
            if (!selectedDate) return;
            await calculateRangeOrderInternal(selectedDate, selectedDate, 'day-calculation-result');
        }

        async function calculateRangeOrderInternal(start, end, targetId) {
            const res = await fetch(`/api/dashboard/range-orders?start=${start}&end=${end}`);
            const data = await res.json();
            const skuSummary = data.sku_summary || [];

            if (skuSummary.length === 0) {
                document.getElementById(targetId).innerHTML = '<div class="status show info">ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // ë¶€ìœ„ë³„ ì§‘ê³„
            const partTotals = {};
            skuSummary.forEach(item => {
                const sku = skuProducts.find(s => s.sku_name === item.sku_name);
                if (sku && sku.compositions) {
                    sku.compositions.forEach(comp => {
                        const key = comp.part_name;
                        if (!partTotals[key]) partTotals[key] = { weight: 0, packs: 0 };
                        partTotals[key].weight += comp.weight * item.total_qty;
                        partTotals[key].packs += item.total_qty;
                    });
                }
            });

            let html = '<div class="result-box" style="margin-top: 16px;"><h4>ë°œì£¼ëŸ‰ ê³„ì‚° ê²°ê³¼</h4>';
            html += `<table style="width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 8px;">
                <thead><tr style="background: #f5f5f5;">
                    <th style="padding: 6px; border: 1px solid #ddd;">í’ˆëª©</th>
                    <th style="padding: 6px; border: 1px solid #ddd; text-align: center;">ìˆ˜ëŸ‰</th>
                    <th style="padding: 6px; border: 1px solid #ddd; text-align: center;">ì´ì¤‘ëŸ‰</th>
                </tr></thead>
                <tbody>
                    ${Object.entries(partTotals).map(([part, data]) => `
                        <tr>
                            <td style="padding: 6px; border: 1px solid #ddd;">${escapeHtml(part)}</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${data.packs}íŒ©</td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${(data.weight / 1000).toFixed(2)}kg</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table></div>`;

            document.getElementById(targetId).innerHTML = html;
        }

        function openAddUserModal() {
            document.getElementById('new-user-name').value = '';
            document.getElementById('user-modal').classList.add('show');
        }

        function closeUserModal() {
            document.getElementById('user-modal').classList.remove('show');
        }

        async function addUser() {
            const name = document.getElementById('new-user-name').value.trim();
            if (!name) {
                showToast('ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            showLoading();
            try {
                await fetch('/api/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, role: 'user' })
                });
                await loadUsers();
                renderUserMenus();
                closeUserModal();
                showToast('ì‚¬ìš©ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (e) {
                showToast('ì‚¬ìš©ì ì¶”ê°€ ì‹¤íŒ¨', 'error');
            }
            hideLoading();
        }

        function openAddPartModal() {
            document.getElementById('part-name').value = '';
            document.getElementById('part-price').value = '';
            document.getElementById('part-modal').classList.add('show');
        }

        function closePartModal() {
            document.getElementById('part-modal').classList.remove('show');
        }

        async function savePart() {
            const name = document.getElementById('part-name').value.trim();
            const price = parseInt(document.getElementById('part-price').value) || 0;

            if (!name) {
                showToast('ë¶€ìœ„ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            showLoading();
            try {
                await fetch('/api/parts-cost', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ part_name: name, price_per_100g: price, cost_type: 'weight' })
                });
                await loadPartsData();
                closePartModal();
                showToast('ë¶€ìœ„ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (e) {
                showToast('ì €ì¥ ì‹¤íŒ¨', 'error');
            }
            hideLoading();
        }

        async function deletePart(name) {
            if (!confirm(`"${name}" ë¶€ìœ„ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            // TODO: ì‚­ì œ API í˜¸ì¶œ
            showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            await loadPartsData();
        }

        function openAddPackagingModal() {
            document.getElementById('packaging-name').value = '';
            document.getElementById('packaging-price').value = '';
            document.getElementById('packaging-modal').classList.add('show');
        }

        function closePackagingModal() {
            document.getElementById('packaging-modal').classList.remove('show');
        }

        async function savePackaging() {
            const name = document.getElementById('packaging-name').value.trim();
            const price = parseInt(document.getElementById('packaging-price').value) || 0;

            if (!name) {
                showToast('í¬ì¥ì¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            showLoading();
            try {
                await fetch('/api/packaging-cost', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ packaging_name: name, price })
                });
                await loadPackagingData();
                closePackagingModal();
                showToast('í¬ì¥ì¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (e) {
                showToast('ì €ì¥ ì‹¤íŒ¨', 'error');
            }
            hideLoading();
        }

        async function deletePackaging(name) {
            if (!confirm(`"${name}" í¬ì¥ì¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            await loadPackagingData();
        }

        function openAddSkuModal() {
            editingSkuId = null;
            document.getElementById('sku-modal-title').textContent = 'SKU ìƒí’ˆ ì¶”ê°€';
            document.getElementById('sku-name').value = '';
            document.getElementById('sku-price').value = '';
            document.getElementById('composition-list').innerHTML = '';
            addCompositionRow();
            document.getElementById('sku-modal').classList.add('show');
        }

        function closeSkuModal() {
            document.getElementById('sku-modal').classList.remove('show');
        }

        function addCompositionRow() {
            const container = document.getElementById('composition-list');
            const row = document.createElement('div');
            row.className = 'form-row';
            row.style.marginBottom = '8px';
            row.innerHTML = `
                <div class="form-group" style="flex: 2;">
                    <select class="comp-part">
                        <option value="">ë¶€ìœ„ ì„ íƒ</option>
                        ${Object.keys(partsData).map(p => `<option value="${escapeHtml(p)}">${escapeHtml(p)}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <input type="number" class="comp-weight" placeholder="ì¤‘ëŸ‰(g)">
                </div>
                <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.remove()">X</button>
            `;
            container.appendChild(row);
        }

        async function saveSku() {
            const name = document.getElementById('sku-name').value.trim();
            const packaging = document.getElementById('sku-packaging').value;
            const price = parseInt(document.getElementById('sku-price').value) || 0;

            if (!name) {
                showToast('ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            const compositions = [];
            document.querySelectorAll('#composition-list .form-row').forEach(row => {
                const part = row.querySelector('.comp-part').value;
                const weight = parseInt(row.querySelector('.comp-weight').value) || 0;
                if (part && weight > 0) {
                    compositions.push({ part_name: part, weight, composition_type: 'weight' });
                }
            });

            showLoading();
            try {
                const method = editingSkuId ? 'PUT' : 'POST';
                const url = editingSkuId ? `/api/sku-products/${editingSkuId}` : '/api/sku-products';

                await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sku_name: name, packaging, selling_price: price, compositions })
                });
                await loadSkuProducts();
                closeSkuModal();
                showToast('SKU ìƒí’ˆì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (e) {
                showToast('ì €ì¥ ì‹¤íŒ¨', 'error');
            }
            hideLoading();
        }

        function editSku(id) {
            const sku = skuProducts.find(s => s.id === id);
            if (!sku) return;

            editingSkuId = id;
            document.getElementById('sku-modal-title').textContent = 'SKU ìƒí’ˆ ìˆ˜ì •';
            document.getElementById('sku-name').value = sku.sku_name;
            document.getElementById('sku-packaging').value = sku.packaging || '';
            document.getElementById('sku-price').value = sku.selling_price || '';

            const container = document.getElementById('composition-list');
            container.innerHTML = '';
            (sku.compositions || []).forEach(comp => {
                addCompositionRow();
                const rows = container.querySelectorAll('.form-row');
                const lastRow = rows[rows.length - 1];
                lastRow.querySelector('.comp-part').value = comp.part_name;
                lastRow.querySelector('.comp-weight').value = comp.weight;
            });

            document.getElementById('sku-modal').classList.add('show');
        }

        async function deleteSku(id) {
            if (!confirm('ì´ SKU ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            showLoading();
            try {
                await fetch(`/api/sku-products/${id}`, { method: 'DELETE' });
                await loadSkuProducts();
                showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (e) {
                showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
            }
            hideLoading();
        }

        function openAddMappingModal() {
            document.getElementById('mapping-vendor').value = '';
            document.getElementById('mapping-code').value = '';
            document.getElementById('mapping-product-name').value = '';
            document.getElementById('mapping-sku').value = '';
            document.getElementById('mapping-modal').classList.add('show');
        }

        function closeMappingModal() {
            document.getElementById('mapping-modal').classList.remove('show');
        }

        async function saveMapping() {
            const vendor = document.getElementById('mapping-vendor').value.trim();
            const code = document.getElementById('mapping-code').value.trim();
            const productName = document.getElementById('mapping-product-name').value.trim();
            const skuId = document.getElementById('mapping-sku').value;

            if (!vendor) {
                showToast('ê±°ë˜ì²˜ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            showLoading();
            try {
                await fetch('/api/vendor-mappings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        vendor_name: vendor,
                        product_code: code,
                        product_name: productName,
                        sku_product_id: skuId ? parseInt(skuId) : null
                    })
                });
                await loadVendorMappingsAll();
                closeMappingModal();
                showToast('ë§¤í•‘ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (e) {
                showToast('ì €ì¥ ì‹¤íŒ¨', 'error');
            }
            hideLoading();
        }

        async function deleteMapping(id) {
            if (!confirm('ì´ ë§¤í•‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            showLoading();
            try {
                await fetch(`/api/vendor-mappings/${id}`, { method: 'DELETE' });
                await loadVendorMappingsAll();
                showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (e) {
                showToast('ì‚­ì œ ì‹¤íŒ¨', 'error');
            }
            hideLoading();
        }

        // ==================== ìœ í‹¸ë¦¬í‹° ====================
        function updateConnectionStatus(connected) {
            const el = document.getElementById('connection-status');
            if (!el) return;
            const textEl = el.querySelector('.text');
            if (!textEl) return;
            if (connected) {
                el.classList.add('connected');
                textEl.textContent = 'PostgreSQL ì—°ê²°ë¨';
            } else {
                el.classList.remove('connected');
                textEl.textContent = 'ì—°ê²° ëŠê¹€';
            }
        }

        function updateVendorSelect() {
            const vendors = [...new Set(vendorMappings.map(m => m.vendor_name))];
            const select = document.getElementById('vendor-name');
            if (select) {
                select.innerHTML = '<option value="">ë°œì£¼ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>' +
                    vendors.map(v => `<option value="${escapeHtml(v)}">${escapeHtml(v)}</option>`).join('');
            }
        }

        function updateVendorFilterSelect() {
            const vendors = [...new Set(vendorMappings.map(m => m.vendor_name))];
            const select = document.getElementById('vendor-filter');
            if (select) {
                select.innerHTML = '<option value="">ì „ì²´</option>' +
                    vendors.map(v => `<option value="${escapeHtml(v)}">${escapeHtml(v)}</option>`).join('');
            }
        }

        function updateIntegratedUserFilter() {
            const select = document.getElementById('integrated-user-filter');
            if (select) {
                select.innerHTML = '<option value="">ì „ì²´</option>' +
                    userList.map(u => `<option value="${u.id}">${escapeHtml(u.name)}</option>`).join('');
            }
        }

        function updatePackagingSelect() {
            const select = document.getElementById('sku-packaging');
            if (select) {
                select.innerHTML = '<option value="">í¬ì¥ì¬ ì„ íƒ</option>' +
                    Object.keys(packagingData).map(p => `<option value="${escapeHtml(p)}">${escapeHtml(p)}</option>`).join('');
            }
        }

        function updateSkuSelect() {
            const select = document.getElementById('mapping-sku');
            if (select) {
                select.innerHTML = '<option value="">SKU ì„ íƒ</option>' +
                    skuProducts.map(s => `<option value="${s.id}">${escapeHtml(s.sku_name)}</option>`).join('');
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        }

        function goToToday() {
            currentYear = new Date().getFullYear();
            currentMonth = new Date().getMonth();
            renderCalendar();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('show');
            document.querySelector('.overlay').classList.toggle('show');
        }

        function showLoading() {
            document.getElementById('loading').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function escapeHtml(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;');
        }

        function downloadIntegratedExcel() {
            showToast('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì¤€ë¹„ ì¤‘...', 'info');
            // TODO: ì—‘ì…€ ë‹¤ìš´ë¡œë“œ êµ¬í˜„
        }

        function loadVendorMappings() {
            renderVendorMappingTable();
        }

        // ==================== ë°œì£¼ì„œ ë³€í™˜ ====================
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');

        if (uploadArea) {
            uploadArea.onclick = () => fileInput.click();
            uploadArea.ondragover = (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); };
            uploadArea.ondragleave = () => uploadArea.classList.remove('dragover');
            uploadArea.ondrop = (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            };
        }

        if (fileInput) {
            fileInput.onchange = () => handleFiles(fileInput.files);
        }

        function handleFiles(files) {
            if (files.length > 0) {
                const names = Array.from(files).map(f => f.name).join(', ');
                document.getElementById('file-info').textContent = `ì„ íƒë¨: ${names}`;
                document.getElementById('file-info').classList.add('show');
                document.getElementById('btn-convert').disabled = false;
            }
        }

        function convertOrders() {
            showToast('ë°œì£¼ì„œ ë³€í™˜ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }

        function confirmConvertedData() {
            showToast('ë³€í™˜í™•ì • ì´ë™ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }

        function registerOrders() {
            showToast('ì£¼ë¬¸ ë“±ë¡ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }

        function downloadConfirmedExcel() {
            showToast('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }

        function downloadOrderExcel() {
            showToast('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }

        function bulkUpdateStatus(field, value) {
            showToast(`ìƒíƒœ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.`, 'info');
        }
    </script>
</body>
</html>